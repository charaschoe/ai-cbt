# üß† Conversational Therapy AI - Umfassende Dokumentation

Eine datenschutzorientierte, webbasierte Kognitive Verhaltenstherapie (KVT) Schnittstelle mit KI-gest√ºtzter emotionaler Analyse, Sprachinteraktion und dynamischer Emotionsvisualisierung.

## üöÄ Hauptfunktionen

### Kernfunktionalit√§t

-   **KVT-basierte Therapiesitzungen**: Professionelle therapeutische Gespr√§che nach KVT-Prinzipien mit sokratischen Fragen und kognitiver Mustererkennung
-   **Duale Interaktionsmodi**: Nahtloses Wechseln zwischen Text- und Sprachinteraktion je nach Umgebung oder Pr√§ferenz
-   **Echtzeit-Emotionsanalyse**: Automatische Stimmungserkennung und kognitive Mustererkennung aus Benutzereingaben
-   **Dynamische Emotionsvisualisierung**: Interaktive Emotionsblasen, die basierend auf Gespr√§chsthemen und Intensit√§t wachsen und sich ver√§ndern
-   **Gesichtsemotionserkennung**: Kamerabasierte Emotionserkennung mit Computer Vision
-   **Krisenerkennung**: Automatische Identifikation von Krisensituationen mit sofortigen Unterst√ºtzungsressourcen-Empfehlungen
-   **Umgebungsger√§uscherkennung**: Intelligenter Moduswechsel basierend auf Umgebungsger√§uschpegeln

### üåç Mehrsprachige Unterst√ºtzung

#### Automatische Spracherkennung

-   **Echtzeitanalyse**: Erkennt die Sprache aus Benutzereingaben basierend auf sprachspezifischen Indikatoren
-   **Unterst√ºtzte Sprachen**: Deutsch, Englisch, Franz√∂sisch, Spanisch, Italienisch
-   **Fallback-Mechanismus**: Standardm√§√üig auf Deutsch bei unsicherer Erkennung

#### Adaptive System-Prompts

-   **Dynamische Anpassung**: System-Prompt wechselt automatisch basierend auf erkannter Sprache
-   **KVT-Konsistenz**: Therapeutische Prinzipien bleiben in allen Sprachen gleich
-   **Professionelle Standards**: Empathische, nicht-wertende Haltung in jeder Sprache

#### Mehrsprachige Krisenintervention

-   **Sprachspezifische Schl√ºsselw√∂rter**: Erkennt Krisensignale in allen unterst√ºtzten Sprachen
-   **Lokalisierte Hilfsressourcen**: Passende Notfallnummern und Ressourcen je Sprache
-   **Sofortige Reaktion**: Priorit√§t f√ºr Sicherheit √ºber Sprachpr√§ferenzen

### üé≠ Erweiterte Gesichtsausdrucks- und Semantik-Features

#### Gesichtsausdruck-Semantik

-   **Dynamische Ausdruckserkennung**: KI analysiert Nachrichteninhalt und Benutzereingabe zur Bestimmung angemessener Gesichtsausdr√ºcke
-   **6 Kernausdr√ºcke**: Gl√ºcklich, Traurig, Nachdenklich, √Ñngstlich, √úberrascht, Neutral
-   **Emotionale Zustandszuordnung**: Jeder Ausdruck ordnet sich therapeutischen emotionalen Zust√§nden zu (empathisch, festlich, beruhigend, verst√§ndnisvoll, kontemplativ, unterst√ºtzend)

#### Erweiterte Chat-Funktionen

-   **Verbesserte Tastaturpositionierung**: Tastatur um 30px nach unten verschoben f√ºr bessere Bildschirmnutzung
-   **Fortgeschrittenes Chat-Scrolling**: Sanftes Auto-Scroll mit alter Nachrichten-Erkennung
-   **Ellipsis-Barriere**: Visueller Indikator erscheint oben beim Betrachten alter Nachrichten
-   **Erweiterte Container**: 60% H√∂henzuteilung (70% bei versteckter Tastatur) f√ºr bessere Inhaltsanzeige

### Therapeutische Werkzeuge

-   **Gedankenmustererkennung**: Identifiziert kognitive Verzerrungen wie Schwarz-Wei√ü-Denken, Katastrophisieren und Selbstabwertung
-   **Themenextraktion**: Kategorisiert Gespr√§che automatisch in Themen (Arbeitsstress, Beziehungen, Selbstwert, etc.)
-   **Emotions-Dashboard**: Visuelle Zeitlinie und Intensit√§tsverfolgung emotionaler Zust√§nde √ºber die Zeit
-   **Sitzungshistorie**: Persistente Verfolgung therapeutischen Fortschritts und wiederkehrender Muster

## üõ† Technologie-Stack

### Backend

-   **Framework**: FastAPI (0.95.2) mit Uvicorn ASGI Server
-   **KI/ML-Bibliotheken**:
    -   OpenAI Whisper (1.0) f√ºr Sprach-zu-Text
    -   Transformers (4.33.2) und PyTorch (2.0.1) f√ºr ML-Verarbeitung
    -   FER (22.9) f√ºr Gesichtsemotionserkennung
    -   OpenCV (4.8.0.76) f√ºr Computer Vision
-   **Audio-Verarbeitung**: Pydub (0.25.1) und SpeechRecognition (3.10.0)
-   **LLM-Integration**: Benutzerdefinierte API-Integration mit Kitegg Chat-Service unter Verwendung des Mistral-Small-3.1-24B-Instruct-Modells
-   **Dateiverarbeitung**: python-multipart f√ºr Datei-Uploads

### Frontend

#### Vanilla JavaScript Interface

-   **Kern**: Vanilla JavaScript mit modernen Web-APIs
-   **Verwendete Web-APIs**:
    -   Web Audio API f√ºr Umgebungsger√§uscherkennung
    -   MediaDevices API f√ºr Kamera- und Mikrofonzugang
    -   Canvas API f√ºr Bildverarbeitung
    -   Fetch API f√ºr Backend-Kommunikation
-   **Styling**: Modernes CSS mit Google Fonts (Inter)
-   **UI-Features**: Responsive Design, Touch-/Wischgesten, Echtzeit-visuelles Feedback

#### React-Komponenten Interface

-   **Framework**: React 18.2.0 mit modernem JSX
-   **Build-Tools**: Webpack 5.88.0 mit Babel-Loader
-   **Entwicklung**: Webpack Dev Server mit Hot Reload
-   **Komponenten**:
    -   [`ChatFlow07.jsx`](conversational-therapy-ai/frontend/react-components/src/components/ChatFlow07.jsx:1) - Hauptchat-Interface mit emotionaler Intelligenz
    -   [`SwipeContainer.jsx`](conversational-therapy-ai/frontend/react-components/src/components/SwipeContainer.jsx:1) - Touch-Gesten-Unterst√ºtzung
    -   [`KeyboardIPhoneTypeDefault.jsx`](conversational-therapy-ai/frontend/react-components/src/components/KeyboardIPhoneTypeDefault.jsx:1) - iOS-Tastatur-Integration
    -   [`OrbsV3Property1Variant4.jsx`](conversational-therapy-ai/frontend/react-components/src/components/OrbsV3Property1Variant4.jsx:1) - Emotionsvisualisierungen

### Externe Services

-   **Text-zu-Sprache**: ElevenLabs API-Integration (optional)
-   **LLM-Verarbeitung**: Kitegg AI-Service mit Mistral-Modell

## üìã Voraussetzungen

### Erforderliche Software

1. **Python 3.9+**

    - Download von [python.org](https://www.python.org/downloads/)
    - pip Paket-Manager (normalerweise enthalten)

2. **Node.js 16+** (f√ºr React-Komponenten)

    - Download von [nodejs.org](https://nodejs.org/)
    - npm Paket-Manager (enthalten)

3. **Git** (optional, zum Klonen)
    - Download von [git-scm.com](https://git-scm.com/downloads/)

### Erforderliche API-Schl√ºssel

1. **Kitegg API-Schl√ºssel** (Erforderlich f√ºr LLM-Funktionalit√§t)

    - Kontaktiere Kitegg-Service f√ºr API-Zugang
    - Verwendet f√ºr KVT-Therapiegespr√§che-Verarbeitung

2. **ElevenLabs API-Schl√ºssel** (Optional f√ºr erweiterte TTS)
    - Registrierung bei [elevenlabs.io](https://elevenlabs.io/)
    - Nur ben√∂tigt bei Implementierung vollst√§ndiger Text-zu-Sprache-Features

### Browser-Anforderungen

-   Moderner Browser mit Unterst√ºtzung f√ºr:
    -   Web Audio API
    -   MediaDevices API (Kamera-/Mikrofonzugang)
    -   Canvas API
    -   ES6+ JavaScript-Features

## üöÄ Installation & Setup

### 1. Repository klonen

```bash
git clone <repository-url>
cd conversational-therapy-ai
```

### 2. Backend-Setup

```bash
cd backend

# Python-Abh√§ngigkeiten installieren
pip install -r requirements.txt

# Konfigurationsdatei erstellen
cp config_example.py config_secret.py
```

### 3. API-Schl√ºssel konfigurieren

Bearbeite [`backend/config_secret.py`](conversational-therapy-ai/backend/config_secret.py:1):

```python
# Erforderlich f√ºr LLM-Funktionalit√§t
CHAT_KITEGG_API_KEY = "dein_kitegg_api_schluessel_hier"

# Optional f√ºr erweiterte TTS
ELEVENLABS_API_KEY = "dein_elevenlabs_schluessel_hier"  # oder als Platzhalter belassen
```

### 4. Backend-Server starten

```bash
# Aus dem Backend-Verzeichnis
uvicorn server:app --host 0.0.0.0 --port 8000 --reload
```

Der Server startet unter `http://localhost:8000`

### 5. Frontend-Setup

#### Option A: Vanilla JavaScript Interface

```bash
# Vom Projektroot, Frontend bereitstellen
cd frontend
python -m http.server 8080

# Oder einfach index.html in einem modernen Browser √∂ffnen
```

Zugriff auf die Anwendung unter `http://localhost:8080`

#### Option B: React-Komponenten Interface

```bash
# React-Abh√§ngigkeiten installieren
cd frontend/react-components
npm install

# Development Server starten
npm start
```

Zugriff auf die React-Anwendung unter `http://localhost:3000`

## üí° Wie es funktioniert

### Architektur-√úbersicht

```
Benutzereingabe ‚Üí Web-Interface ‚Üí FastAPI Backend ‚Üí KI-Verarbeitung ‚Üí Antwort
     ‚Üì              ‚Üì              ‚Üì              ‚Üì             ‚Üì
Text/Sprache ‚Üí Audio-Verarbeitung ‚Üí LLM-Analyse ‚Üí Emotionserkennung ‚Üí UI-Update
```

### Gespr√§chsablauf

1. **Eingabeverarbeitung**: Benutzer liefert Text- oder Spracheingabe
2. **Transkription**: Spracheingabe wird mit Whisper in Text umgewandelt
3. **KI-Analyse**: Text wird von Mistral LLM mit KVT-spezifischen Prompts verarbeitet
4. **Emotionserkennung**: Stimmung und kognitive Muster analysiert
5. **Antwortgenerierung**: Therapeutische Antwort nach KVT-Prinzipien generiert
6. **Visualisierungsupdate**: Emotionsblasen und Dashboard in Echtzeit aktualisiert

### API-Endpunkte

-   `POST /chat`: Haupt-Therapiegespr√§che-Endpunkt
-   `POST /transcribe`: Sprach-zu-Text-Konvertierung
-   `POST /speak`: Text-zu-Sprache-Synthese
-   `POST /analyze-face`: Gesichtsemotionserkennung
-   `GET /blobs`: Emotionsvisualisierungsdaten

### Datenverarbeitung

-   **Stimmungsanalyse**: Schl√ºsselwortbasierte Emotionsklassifikation (positiv, negativ, neutral, Krise, gemischt)
-   **Mustererkennung**: Erkennung kognitiver Verzerrungen und Gedankenmuster
-   **Themenextraktion**: Kategorisierung in therapeutische Themen (Arbeit, Beziehungen, Selbstwert, etc.)
-   **Blasenberechnung**: Dynamische Gr√∂√üenbestimmung und Einf√§rbung basierend auf H√§ufigkeit und Intensit√§t

## üåê Unterst√ºtzte Sprachen

| Sprache  | Code | Status         | Krisenunterst√ºtzung            |
| -------- | ---- | -------------- | ------------------------------ |
| Deutsch  | `de` | ‚úÖ Vollst√§ndig | ‚úÖ Telefonseelsorge            |
| English  | `en` | ‚úÖ Vollst√§ndig | ‚úÖ National Suicide Prevention |
| Fran√ßais | `fr` | ‚úÖ Vollst√§ndig | ‚úÖ SOS Amiti√©                  |
| Espa√±ol  | `es` | ‚úÖ Vollst√§ndig | ‚úÖ Tel√©fono de la Esperanza    |
| Italiano | `it` | ‚úÖ Vollst√§ndig | ‚úÖ Telefono Amico              |

### Spracherkennungsalgorithmus

#### Erkennungsmethodik

1. **Lexikalische Analyse**: H√§ufige W√∂rter pro Sprache
2. **Mustererkennung**: Sprachspezifische Zeichen und Kombinationen
3. **Gewichtetes Scoring**: Punktesystem f√ºr Sprachmerkmale
4. **Konfidenz-Schwellenwert**: Mindestpunktzahl f√ºr sichere Erkennung

#### Erkennungsgenauigkeit

-   **Kurze Texte (< 10 W√∂rter)**: ~85% Genauigkeit
-   **Mittlere Texte (10-30 W√∂rter)**: ~95% Genauigkeit
-   **L√§ngere Texte (> 30 W√∂rter)**: ~98% Genauigkeit

## üé® Gesichtsausdruck-Logik

### Ausdruckserkennung-Algorithmus

Die KI analysiert sowohl KI-Antwort als auch Benutzereingabe und gibt zur√ºck: "gl√ºcklich", "traurig", "√§ngstlich", "w√ºtend", "√ºberrascht", "nachdenklich", "neutral"

### Emotionale Zustandszuordnung

-   **Traurig ‚Üí Empathisch**: Blau-get√∂nte Antworten mit beruhigenden Animationen
-   **Gl√ºcklich ‚Üí Festlich**: Golden-get√∂nte Antworten mit Leuchteffekten
-   **√Ñngstlich ‚Üí Beruhigend**: Gr√ºn-get√∂nte Antworten mit gleichm√§√üigen Animationen
-   **Nachdenklich ‚Üí Kontemplativ**: Lila-get√∂nte Antworten mit tiefen Pulseffekten
-   **√úberrascht ‚Üí Neugierig**: Gr√ºn-get√∂nte Antworten mit Sprunganimationen

### Dynamische Denkdauer

-   **Nachdenkliche Antworten**: 2.5-3.5 Sekunden (tiefere Kontemplation)
-   **Empathische Antworten**: 2-3 Sekunden (Emotionsverarbeitung)
-   **Gl√ºckliche Antworten**: 1-2 Sekunden (schnelle positive Antwort)
-   **Basis-Antworten**: 1.5-2.5 Sekunden (Standard-Denkzeit)

## üîß Konfigurationsoptionen

### Backend-Konfiguration

-   **Server-Einstellungen**: Host, Port und CORS-Einstellungen in [`server.py`](conversational-therapy-ai/backend/server.py:1) modifizieren
-   **LLM-Parameter**: Modelleinstellungen und Prompts in [`llm.py`](conversational-therapy-ai/backend/llm.py:1) anpassen
-   **Analyse-Sensibilit√§t**: Stimmungserkennungs-Schl√ºsselw√∂rter in [`analysis.py`](conversational-therapy-ai/backend/analysis.py:1) anpassen

### Frontend-Anpassung

-   **Visuelle Themes**: Farben und Styling in [`styles.css`](conversational-therapy-ai/frontend/styles.css:1) modifizieren
-   **Interaktionsmodi**: Ger√§uscherkennungsempfindlichkeit in [`script.js`](conversational-therapy-ai/frontend/script.js:1) anpassen
-   **UI-Verhalten**: Animations- und Feedback-Einstellungen anpassen

## üîí Datenschutz & Sicherheit

-   **Lokale Verarbeitung**: Kern-Emotionsanalyse wird lokal durchgef√ºhrt
-   **Keine Datenspeicherung**: Sitzungsdaten werden nur im Speicher gehalten (nicht auf Festplatte gespeichert)
-   **Benutzerkontrolle**: Kamera- und Mikrofonzugang erfordert explizite Berechtigung
-   **API-Sicherheit**: Sichere API-Schl√ºsselverarbeitung mit umgebungsbasierter Konfiguration

## üö® Krisenintervention

### Mehrsprachige Schl√ºsselw√∂rter

Das System erkennt Krisensignale in allen Sprachen:

-   **Suizidalit√§t**: "suizid", "suicide", "suicidio", etc.
-   **Selbstverletzung**: "ritzen", "cutting", "autolesi√≥n", etc.
-   **Lebensm√ºdigkeit**: "sterben wollen", "want to die", "veux mourir", etc.

### Sofortreaktionen

-   **Priorit√§t**: Krisenintervention hat Vorrang vor Spracherkennung
-   **Lokalisierte Hilfe**: Passende Notfallnummern basierend auf erkannter Sprache
-   **Professionelle Weiterleitung**: Sofortige Empfehlung professioneller Hilfe

## üß™ Testing

### Automatisierte Tests

```bash
# Testskript ausf√ºhren
python test_multilingual.py
```

Das Testskript √ºberpr√ºft:

-   ‚úÖ Spracherkennung in allen 5 Sprachen
-   ‚úÖ Krisenerkennung mehrsprachig
-   ‚úÖ System-Prompt-Wechsel
-   ‚úÖ Therapeutische Antwortqualit√§t

### Manuelle Tests

#### Beispiel-Eingaben f√ºr verschiedene Sprachen:

**Deutsch:**

```
"Ich f√ºhle mich heute sehr gestresst und √§ngstlich."
```

**English:**

```
"I'm feeling really overwhelmed with work lately."
```

**Fran√ßais:**

```
"Je me sens tr√®s triste aujourd'hui."
```

**Espa√±ol:**

```
"Estoy muy preocupado por mi futuro."
```

**Italiano:**

```
"Mi sento molto arrabbiato ultimamente."
```

## üöß Entwicklungsstatus

### Vollst√§ndig implementiert

-   ‚úÖ KVT-basiertes Gespr√§chssystem
-   ‚úÖ Echtzeit-Emotionsanalyse
-   ‚úÖ Dynamische Emotionsvisualisierung
-   ‚úÖ Gesichtsemotionserkennung
-   ‚úÖ Umgebungsger√§uscherkennung
-   ‚úÖ Kriseninterventionserkennung
-   ‚úÖ Mehrsprachige Unterst√ºtzung (5 Sprachen)
-   ‚úÖ React-Komponenten-Interface
-   ‚úÖ Erweiterte Gesichtsausdruck-Semantik

### Platzhalter/TODO

-   ‚ö†Ô∏è Whisper Sprach-zu-Text-Integration (derzeit Platzhalter)
-   ‚ö†Ô∏è ElevenLabs Text-zu-Sprache-Implementierung (derzeit Platzhalter)
-   ‚ö†Ô∏è Sitzungspersistenz und Benutzerkonten
-   ‚ö†Ô∏è Erweiterte biometrische Integration

## üîÆ Zukunftserweiterungen

### Geplante Sprachen

-   üá≥üá± Niederl√§ndisch
-   üáµüáπ Portugiesisch
-   üá∑üá∫ Russisch
-   üá®üá≥ Chinesisch (Mandarin)
-   üáØüáµ Japanisch

### Erweiterte Features

-   **Sprachmischung**: Erkennung von Code-Switching
-   **Dialekt-Support**: Regionale Varianten
-   **Kulturelle Anpassung**: Kultursensitive Therapieans√§tze
-   **Stimm-Spracherkennung**: Integration mit Audio-Processing
-   **Progressive Web App**: Mobile-optimierte Erfahrung mit Offline-Funktionalit√§t

## üìà Performance-Optimierung

### Caching-Strategien

-   **System-Prompt-Cache**: Vermeidet wiederholte Prompt-Generierung
-   **Spracherkennung-Cache**: Speichert Erkennungsergebnisse f√ºr h√§ufige Phrasen

### Skalierung

-   **Modulare Architektur**: Einfache Erweiterung um neue Sprachen
-   **API-Effizienz**: Minimale Latenz durch optimierte Algorithmen
-   **Memory-Management**: Effiziente Speichernutzung bei Chat-Historie

## ü§ù Beitragen

### Neue Sprache hinzuf√ºgen

1. **Schl√ºsselw√∂rter definieren** in [`language_detection.py`](conversational-therapy-ai/backend/language_detection.py:1)
2. **System-Prompt √ºbersetzen** f√ºr KVT-Prinzipien
3. **Krisenressourcen hinzuf√ºgen** mit lokalen Notfallnummern
4. **Tests erweitern** im [`test_multilingual.py`](conversational-therapy-ai/test_multilingual.py:1)

### Code-Qualit√§t

-   **Type Hints**: Vollst√§ndige Typisierung
-   **Dokumentation**: Ausf√ºhrliche Docstrings
-   **Testing**: Umfassende Testabdeckung
-   **Internationalisierung**: i18n-konforme Implementierung

1. Repository forken
2. Feature-Branch erstellen (`git checkout -b feature/amazing-feature`)
3. √Ñnderungen committen (`git commit -m 'Add amazing feature'`)
4. Zum Branch pushen (`git push origin feature/amazing-feature`)
5. Pull Request √∂ffnen

## üìÑ Lizenz

Dieses Projekt ist unter der MIT-Lizenz lizenziert. Siehe die LICENSE-Datei f√ºr Details.

## ‚ö†Ô∏è Haftungsausschluss

Diese Anwendung ist f√ºr therapeutische Unterst√ºtzung und Selbstreflexion konzipiert. Sie ist **kein Ersatz f√ºr professionelle psychische Gesundheitsversorgung**. Bei einer psychischen Gesundheitskrise kontaktieren Sie bitte:

### Deutschland

-   **Notdienste**: 112
-   **Telefonseelsorge**: 0800 111 0 111 oder 0800 111 0 222
-   **Nummer gegen Kummer**: 116 123

### International

-   **Notdienste**: 911 (USA) oder Ihre lokale Notrufnummer
-   **Crisis Text Line**: Text HOME to 741741
-   **National Suicide Prevention Lifeline**: 988 (USA)
-   **International**: Kontaktieren Sie Ihre lokalen Krisenhilfsdienste

Konsultieren Sie immer qualifizierte Fachkr√§fte f√ºr psychische Gesundheit bei schwerwiegenden psychischen Gesundheitsproblemen.

## üìû Support

Bei Fragen zur mehrsprachigen Funktionalit√§t oder anderen Features:

-   **Technische Probleme**: GitHub Issues erstellen
-   **Feature-Anfragen**: Diskussion in GitHub Discussions
-   **Sprachfehler**: Pull Requests mit Korrekturen willkommen

---

_Dieses System wurde entwickelt, um hochwertige KVT-Therapie in mehreren Sprachen zug√§nglich zu machen, w√§hrend professionelle Standards und kulturelle Sensibilit√§t gew√§hrleistet werden._
